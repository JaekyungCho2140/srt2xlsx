# Product Requirements Document (PRD)
## Subtitle File Converter Tool

### 제품 개요
- **제품명**: Subtitle File Converter Tool
- **버전**: 1.6.5
- **목적**: 다국어 자막 파일(.srt)과 Excel 파일(.xlsx) 간 양방향 변환을 지원하는 Windows 전용 데스크톱 도구
- **대상 사용자**: 번역 작업자, 콘텐츠 제작자, 로컬라이제이션 팀

---

## 1. 기술 스택

### 핵심 기술
- **프로그래밍 언어**: Python 3.11+
- **GUI 프레임워크**: CustomTkinter 5.2.2 (모던 UI, 토글 스위치, 모든 UI 컴포넌트)
- **Excel 처리**: openpyxl 3.1.5
- **메모리 모니터링**: psutil 5.9.8
- **인코딩 감지**: chardet 5.2.0
- **실행파일 패키징**: PyInstaller 6.3.0

### 선정 이유
1. **CustomTkinter**: 네이티브 토글 스위치(CTkSwitch) 제공, 모든 UI 컴포넌트 통합 관리
2. **openpyxl**: Excel 포매팅과 스타일링 완벽 지원
3. **psutil**: 메모리 사용량 모니터링 및 사전 체크
4. **chardet**: 다양한 인코딩 파일 자동 감지 (폴백 메커니즘과 함께 사용)
5. **PyInstaller**: 단일 실행 파일 생성

---

## 2. UI 사양

### 창 사양
- **크기**: 300×250 픽셀 (고정, 크기 조절 불가)
- **제목**: "Subtitle File Converter"
- **최소화**: 가능 (작업 표시줄로)
- **최대화**: 비활성화
- **위치**: 화면 중앙에서 시작, 위치 기억 기능

### 프로그램 초기 상태
- **모드 토글 초기값**: `.srt → .xlsx` 모드 (토글 왼쪽)
- **모드 기억**: 마지막 사용 모드를 settings.ini에 저장하여 다음 실행 시 복원
- **설정 파일 위치**: 실행 파일과 같은 폴더
- **파일 다이얼로그 초기 위치**:
  - 첫 실행: 프로그램 실행 위치
  - 이후 실행: 마지막 사용 폴더 (settings.ini에 저장)
- **settings.ini 구조**:
  ```ini
  [UI]
  last_mode = srt_to_xlsx  # 또는 xlsx_to_srt
  window_x = 100            # 창 X 위치 (기본값: 화면 중앙)
  window_y = 100            # 창 Y 위치 (기본값: 화면 중앙)

  [Files]
  last_directory = C:\Users\Documents  # 마지막 사용 디렉토리
  ```
- **설정 파일 처리**:
  - 파일이 없으면 기본값으로 생성
  - 손상된 경우 기본값으로 재생성
  - 읽기 실패 시 기본값 사용 (오류 메시지 없음)

### UI 구성요소

#### 2.1 컴포넌트 절대 좌표
모든 컴포넌트는 place() 메서드로 배치하며, anchor='nw' (좌상단 기준) 사용:
- **토글 스위치**: x=75, y=30 (너비 150, 높이 30)
- **Browse 버튼**: x=100, y=100 (너비 100, 높이 30)
- **파일명 레이블**: x=10, y=140 (너비 280, 높이 20)
- **Convert 버튼**: x=90, y=195 (너비 120, 높이 35)

#### 2.2 모드 토글 스위치 (CustomTkinter CTkSwitch 사용)
- **위치**: 상단 중앙
- **구현**: CustomTkinter의 CTkSwitch 위젯
- **크기**: 너비 150px, 높이 30px
- **디자인**:
  - iOS/Android 스타일 토글 스위치
  - 슬라이딩 애니메이션 (CustomTkinter 기본값 사용)
  - 텍스트: 동적 단일 텍스트
    - 표시 위치: CustomTkinter CTkSwitch의 `text` 파라미터 사용 (스위치 우측에 자동 배치)
    - OFF 상태: switch.configure(text="SRT → XLSX")
    - ON 상태: switch.configure(text="XLSX → SRT")
    - 텍스트 색상: 기본 테마 사용
- **색상**:
  - 활성 배경: #10b981 (녹색)
  - 비활성 배경: #d1d5db (회색)
  - 버튼: #ffffff (흰색)
  - 호버: #059669 (진한 녹색)

#### 2.3 파일 선택 영역
- **버튼 텍스트**: "파일 선택"
- **크기**: 100×30 픽셀
- **위치**: 창 중앙
- **선택된 파일 표시**:
  - 단일 파일: 파일명만 표시
  - 다중 파일: "N개 파일 선택됨" 형식 (개수만 표시)
  - **툴팁 없음**: 파일 목록 표시 안 함

#### 2.4 변환 버튼
- **텍스트**: "변환"
- **크기**: 120×35 픽셀
- **위치**: 하단 중앙
- **구현**: CustomTkinter CTkButton
- **색상**:
  - 기본: CustomTkinter 기본 테마
  - 비활성: disabled 상태 (회색)

#### 2.5 진행 상황 표시
- **진행 표시**: **최소**, 아래 **처리 중 표시**만 구현 (프로그레스 바, 퍼센트, "처리 중..." 텍스트 금지)
- **처리 중 표시**:
  - Convert 버튼 비활성화
  - 커서를 wait (모래시계)로 변경
- **사용자 피드백**: 완료 후 메시지 박스 표시

#### 2.6 창 위치 초기화
- **창 위치 초기화**:
  - settings.ini에 window_x/y 없음 → 화면 중앙 계산
  - 계산 방법: (screen_width - 300) // 2, (screen_height - 250) // 2
  - 다중 모니터: 기본 모니터 기준

### 메시지 및 언어
- **UI 언어**: 한국어
- **메시지 박스**: Windows 기본 스타일
- **폰트**: 시스템 기본 폰트

---

## 3. 파일 처리 사양

### 3.1 SRT 파일 형식
- **인코딩 감지 순서**:
  1. UTF-8 BOM 체크 (있으면 즉시 UTF-8 사용)
  2. UTF-8로 디코딩 시도 (성공 시 UTF-8 사용)
  3. CP949로 디코딩 시도 (성공 시 CP949 사용)
  4. chardet로 자동 감지
     - confidence >= 0.7: 감지된 인코딩 사용
     - confidence < 0.7: 신뢰도 부족으로 오류 202 발생
  5. 모두 실패 시 오류 202 발생: "파일 인코딩을 감지할 수 없습니다: [파일명]"
- **구조**:
  ```
  번호
  시작시간 --> 종료시간
  자막 텍스트
  [빈 줄]
  ```
- **시간 형식**: `HH:MM:SS,mmm` (시:분:초,밀리초)

#### 3.1.1 SRT 파싱 규칙
- **자막 번호 검증**:
  - 반드시 1부터 시작
  - 순차적 증가 필수 (1, 2, 3, 4...)
  - 누락 시 오류 (예: 1, 2, 4 → 오류 "자막 번호 3 누락")
  - 빈 행은 자막 구분자로만 사용, 무시하지 않음
- **빈 자막 텍스트**: 허용 (Excel에 빈 문자열로 저장)
- **HTML 태그**: 태그 포함하여 그대로 Excel에 저장
- **특수문자/이모지**: 그대로 보존
- **개행 문자**: Excel 셀 내에서 줄바꿈 유지
- **타임스탬프 검증**:
  - 시작 시간 < 종료 시간
  - 24시간 이내 (00:00:00,000 ~ 23:59:59,999)

### 3.2 Excel 파일 형식
- **헤더 행** (정확히 일치 필수, 대소문자 구분):
  - 열 1: "No"
  - 열 2: "Start"
  - 열 3: "End"
  - 열 4-12: "KO", "EN", "CT", "CS", "JA", "TH", "ES-LATAM", "PT-BR", "RU"
- **포매팅**: (변경 없음)
  - 헤더: 굵은 글씨, 배경색 #E7F3FF
  - 셀 테두리: 모든 셀에 얇은 검은색 테두리
  - 열 너비: 고정 너비 20
  - 행 높이: 내용에 맞춰 자동 조정
  - 긴 텍스트: 자동 줄 바꿈

### 3.3 파일명 규칙
- **형식**: `filename_LANGUAGE-CODE.srt`
- **지원 언어 코드**: KO, EN, CT, CS, JA, TH, ES-LATAM, PT-BR, RU
- **언어 코드 추출 정규표현식**:
  ```python
  pattern = r".*_(KO|EN|CT|CS|JA|TH|ES-LATAM|PT-BR|RU)\.srt$"
  # 대소문자 무시 플래그와 함께 사용 (re.IGNORECASE)
  ```
- **언어 코드 추출 규칙**:
  - 정규표현식으로 언어 코드 추출
  - 마지막 언더스코어 뒤, 확장자 앞 부분이 지원 언어 코드와 일치해야 함
  - 예시:
    - `subtitle_KO.srt` → "KO" ✓
    - `my_file_EN.srt` → "EN" ✓
    - `file_ES-LATAM.srt` → "ES-LATAM" ✓
    - `file_ES_LATAM.srt` → 매칭 실패 (언더스코어 대신 하이픈 필요)
    - `file-KO.srt` → 매칭 실패 (언더스코어 없음)
    - `file_KO_final.srt` → 매칭 실패 ("final"이 .srt 앞에 있음)
- **언어 코드 정규화**: 항상 대문자로 변환 (예: ko → KO)
- **언어 코드 하위 호환성**: 없음 (정확한 매칭만 지원)
- **특수문자 처리**: Windows 금지 문자 사용 시 오류 발생
  - 금지 문자: `\ / : * ? " < > |`
  - 오류 메시지: "파일명에 사용할 수 없는 문자가 포함되어 있습니다"

### 3.4 파일 I/O 방식
- **파일 읽기**: 전체 파일을 한 번에 읽기
- **파일 쓰기**: 임시 파일 생성 후 이동
  - 임시 파일명: "{원본파일명}.tmp.{YYYYMMDDHHmmss}"
  - 타임스탬프 형식: `YYYYMMDDHHmmss` (예: 20250112143052)
  - 이동 성공 시 임시 파일 삭제
  - 이동 실패 시 임시 파일 삭제 시도 (실패 시 무시)
  - 임시 파일 정리: 프로그램 시작 시 **출력 파일이 저장될 디렉토리**에서 `*.tmp.*` 패턴 파일 삭제
    - SRT → XLSX: 첫 번째 SRT 파일이 위치한 폴더
    - XLSX → SRT: XLSX 파일이 위치한 폴더
    - 정리 시점: 파일 다이얼로그에서 파일 선택 직후
    - 실패 시: 무시 (사용자에게 알리지 않음)
- **출력 파일 경로**: 입력 파일과 같은 폴더에 저장
- **메모리 관리**:
  - 변환 전 메모리 사전 체크
  - 필요 메모리 계산:
    - SRT → XLSX: (모든 입력 파일 크기의 합) × 5 (파싱 및 Excel 생성 오버헤드)
    - XLSX → SRT: Excel 파일 크기 × 3 (openpyxl 로딩 오버헤드)
  - 메모리 경고 임계값: 필요 메모리 > (가용 메모리 × 0.7)
  - 안전 마진: 30% (OS 및 다른 프로세스를 위한 여유 공간)
  - 가용 메모리 부족 시 경고 메시지: "메모리가 부족할 수 있습니다. 계속하시겠습니까?"
  - 사용자가 '예' 선택 시 계속 진행, '아니오' 선택 시 중단, 사용자가 '예' 선택 시 try-except MemoryError 처리
  - 계산 예시:
    - 가용 메모리: 4GB
    - 임계값: 4GB × 0.7 = 2.8GB
    - 파일 크기: 1GB → 필요 메모리: 5GB → 경고 표시
- **드라이브 지원**: 사용자 PC에서 접근 가능한 모든 경로 허용 (네트워크 드라이브 포함)
  - **타임아웃**: 구현하지 않음
  - **정책**:
    - 모든 파일 작업은 OS 기본 동작 따름
    - 타임아웃, 재시도 등 개입 없음
    - 네트워크 지연은 사용자가 관리
    - 프로그램은 표준 Python open() 사용
  - **오류 처리**: OSError/IOError 발생 시 즉시 중단
- **Excel 파일 잠금**: 오류 메시지만 표시 ("파일이 이미 열려 있습니다")
  - 재시도 없음, 즉시 종료

---

## 4. 핵심 기능

### 4.1 SRT → XLSX 변환
1. 다중 SRT 파일 선택 (같은 폴더)
2. 파일명에서 언어 코드 자동 감지
3. 타임스탬프 일치 검증
4. Excel 파일 생성 (포매팅 적용)
5. 출력 파일 저장

#### 수락 기준
- [x] 다중 SRT 파일 선택 시 같은 폴더 검증
- [x] 언어 코드 자동 감지 성공
- [x] 타임스탬프 일치 검증 통과
- [x] Excel 파일 생성 및 포매팅 적용
- [x] 중복 파일명 자동 처리: "_N" 접미사 추가 (N=1,2,3..., 최대 999회)
      - 999회 초과 시 오류 206 발생: "출력 파일을 생성할 수 없습니다 (파일명 중복)"
- [x] 자막 번호 순차 검증
- [x] 인코딩 자동 감지 (chardet 사용)

### 4.2 XLSX → SRT 변환
1. Excel 파일 선택
2. 헤더 검증 및 언어 열 식별
3. 언어별 SRT 파일 생성 (빈 열 제외)
4. 출력 파일 저장 (입력 파일과 같은 폴더)

#### 수락 기준
- [x] Excel 헤더 정확히 일치 검증
- [x] 콘텐츠가 있는 언어별 SRT 파일만 생성
- [x] 빈 언어 열 판단 기준:
      1. **빈 셀 정의**:
         - `None` (셀이 비어있음)
         - `""` (빈 문자열)
         - 공백 문자만 포함: `" "`, `"\t"`, `"\n"` 등 → `strip()` 후 빈 문자열
      2. **빈 셀이 아님**:
         - 숫자 `0`
         - Boolean `False`
         - 수식 결과가 위 조건에 해당하지 않는 경우
      3. **Excel 수식 처리 (방어적 최소 구현)**:
         - **정책**: 이 도구는 수식이 없는 순수 텍스트 데이터만 처리 (수식 사용 안 함 전제)
         - **구현**: `load_workbook(filename, data_only=True)` 사용
         - **이유**: 혹시 모를 수식 입력에 대한 방어 (수식 대신 캐시된 값 읽기)
         - **None 처리**: None 값은 빈 문자열("")로 처리
      4. **빈 언어 열 판단**:
         - 헤더를 제외한 **모든 데이터 행**이 위 "빈 셀 정의"에 해당하면 빈 언어 열로 판단
         - 단 하나의 행이라도 내용이 있으면 SRT 파일 생성
- [x] 파일명 규칙 준수
- [x] 특수문자/이모지 보존

### 4.3 검증 기능
- **자막 번호**: 1부터 순차 증가 필수
- **타임스탬프 형식**: HH:MM:SS,mmm 엄격 검증
- **타임스탬프 일치 검증 규칙**:
  - 모든 파일의 자막 개수가 동일해야 함
  - 동일 번호 자막의 타임스탬프가 밀리초까지 일치
  - 불일치 시 즉시 오류 103 발생
  - 예시: KO #1 (00:00:01,000) = EN #1 (00:00:01,000) ✅
  - 예시: KO #1 (00:00:01,000) ≠ EN #1 (00:00:01,001) ❌
- **언어 코드**: 지원 목록과 정확히 일치

### 4.4 다중 인스턴스 처리
- **방식**: 파일 락 사용 (실행 파일과 같은 디렉토리)
- **구현**:
  ```python
  import os
  from pathlib import Path
  import time

  # 실행 파일과 같은 디렉토리에 lock 파일 생성
  exe_dir = Path(os.path.dirname(os.path.abspath(sys.argv[0])))
  lock_file = exe_dir / "srt2xlsx.lock"

  # Stale lock 체크 (24시간 이상 된 lock 파일 삭제)
  if lock_file.exists():
      try:
          file_age = time.time() - lock_file.stat().st_mtime
          if file_age > 86400:  # 24시간
              lock_file.unlink()
      except:
          pass

  if lock_file.exists():
      messagebox.showerror("오류", "프로그램이 이미 실행 중입니다")
      sys.exit()

  lock_file.touch()
  # 프로그램 종료 시 lock_file.unlink() - finally 블록에서 처리
  ```
- **창 활성화**: 구현하지 않음

---

## 5. 오류 처리

### 5.1 오류 코드 체계

#### 검증 오류 (100번대)
| 코드 | 내부 설명 | 사용자 메시지 |
|------|----------|--------------|
| 101 | 자막 번호 순차 오류 | "자막 번호가 순차적이지 않습니다. (누락: #N)" |
| 102 | 타임스탬프 형식 오류 | "타임스탬프 형식이 올바르지 않습니다" |
| 103 | 타임스탬프 동기화 오류 | "파일 간 타임스탬프가 일치하지 않습니다 (자막 #N)" |
| 104 | 자막 번호 중복 | "자막 번호가 중복되었습니다: #N" |
| 105 | 자막 번호 0 시작 | "자막 번호는 1부터 시작해야 합니다" |
| 106 | Excel 헤더 불일치 | "Excel 헤더가 올바르지 않습니다" |
| 107 | 시간 범위 역전 | "종료 시간이 시작 시간보다 빠릅니다 (자막 #N)" |
| 108 | 자막 개수 불일치 | "파일 간 자막 개수가 다릅니다" |

#### 파일 I/O 오류 (200번대)
| 코드 | 내부 설명 | 사용자 메시지 |
|------|----------|--------------|
| 202 | 인코딩 감지 실패 | "파일 인코딩을 감지할 수 없습니다: [파일명]" |
| 203 | Excel 파일 잠금 | "파일이 이미 열려 있습니다: [파일명]" |
| 204 | 언어 코드 오류 | "지원되지 않는 언어 코드: [코드]" |
| 205 | 특수문자 파일명 | "파일명에 사용할 수 없는 문자가 포함되어 있습니다" |
| 206 | 파일명 중복 초과 | "출력 파일을 생성할 수 없습니다 (파일명 중복)" |

#### 시스템 오류 (300번대)
| 코드 | 내부 설명 | 사용자 메시지 |
|------|----------|--------------|
| 301 | 다중 인스턴스 | "프로그램이 이미 실행 중입니다" |
| 302 | 메모리 부족 | "메모리가 부족합니다. 파일 개수를 줄여주세요" |
| 303 | 디스크 공간 부족 | "디스크 공간이 부족합니다" |

### 5.2 오류 처리 방식
- **철학**: 즉시 중단 (안정성 우선)
- **롤백**: All-or-Nothing (전체 롤백)
- **사용자 알림**: 메시지 박스로 표시 (오류 코드 포함)
- **재시도**: 지원하지 않음

#### 롤백 구현 방법 (Two-Phase Commit)
**XLSX → SRT (다중 파일 생성)**:
1. Phase 1: 모든 언어의 임시 파일 생성 및 데이터 쓰기
2. Phase 2: 모든 임시 파일을 최종 위치로 일괄 이동
3. 오류 발생 시:
   - 모든 임시 파일 삭제
   - 부분적으로 이동된 출력 파일 삭제
   - 완전 롤백 보장

**SRT → XLSX (단일 파일 생성)**:
1. 임시 파일 생성 및 데이터 쓰기
2. 최종 위치로 이동
3. 오류 발생 시: 임시 파일만 삭제 (원본 SRT 파일은 영향 없음)

---

## 6. 성능 요구사항

### 6.1 처리 성능
- **아키텍처**: 단일 스레드 (멀티프로세싱 제거)
- **메모리 관리**:
  - psutil로 가용 메모리 체크
  - 필요 메모리 계산 (섹션 3.4 참조)
  - 메모리 부족 시 경고 메시지 후 사용자 선택
- **파일 크기 제한**: 10,000행까지 권장
  - 10,000행 초과 시 경고: "파일이 큽니다. 처리에 시간이 걸릴 수 있습니다. 계속하시겠습니까?"
  - 사용자 선택에 따라 진행 또는 중단
  - 구현: 빠른 라인 카운트 후 자막 개수 추정

### 6.2 UI 반응성
- **처리 중 UI**: 커서를 wait로 변경
- **진행 표시**: 없음
- **완료 알림**: 메시지 박스만

---

## 7. 테스트 요구사항

### 7.1 테스트 범위
- **목표**: 100% (코어 로직)
- **GUI 테스트**: 수동 테스트로 진행
- **테스트 프레임워크**: pytest (코어 로직용)

### 7.2 GUI 테스트 전략
- **수동 테스트**: 테스트 시나리오에 따라 인간이 직접 수행
  - 파일 선택 → 변환 → 저장 워크플로우
  - 모드 전환 동작 검증
  - 토글 애니메이션 확인
  - 레이아웃 및 UI 요소 배치 검증
  - 색상/스타일 일관성 확인
- **자동화 테스트**: 코어 로직만 (pytest)

### 7.3 핵심 테스트 케이스

#### 타임스탬프 일치 검증 테스트
```python
# test_timestamp_sync.py
def test_timestamp_perfect_match():
    """완벽히 일치하는 타임스탬프 - 성공해야 함"""
    files = [
        ("subtitle_ko.srt", [
            "1\n00:00:01,000 --> 00:00:03,500\n안녕하세요",
            "2\n00:00:05,200 --> 00:00:08,750\n반갑습니다"
        ]),
        ("subtitle_en.srt", [
            "1\n00:00:01,000 --> 00:00:03,500\nHello",
            "2\n00:00:05,200 --> 00:00:08,750\nNice to meet you"
        ])
    ]
    assert validate_timestamps(files) == True

def test_timestamp_millisecond_mismatch():
    """1ms 차이 - 실패해야 함"""
    files = [
        ("subtitle_ko.srt", [
            "1\n00:00:01,000 --> 00:00:03,500\n안녕하세요"
        ]),
        ("subtitle_en.srt", [
            "1\n00:00:01,001 --> 00:00:03,500\nHello"  # 1ms 차이
        ])
    ]
    assert validate_timestamps(files) == False
    assert error_code == 103  # 타임스탬프 동기화 오류
```

#### 자막 번호 검증 테스트
```python
def test_subtitle_sequence_valid():
    """올바른 순차 번호 - 성공"""
    subtitles = ["1", "2", "3", "4", "5"]
    assert validate_sequence(subtitles) == True

def test_subtitle_sequence_missing():
    """누락된 번호 - 실패"""
    subtitles = ["1", "2", "4", "5"]  # 3번 누락
    assert validate_sequence(subtitles) == False
    assert error_code == 101  # 자막 번호 순차 오류

def test_subtitle_sequence_duplicate():
    """중복 번호 - 실패"""
    subtitles = ["1", "2", "2", "3"]
    assert validate_sequence(subtitles) == False
    assert error_code == 104  # 자막 번호 중복
```

#### 인코딩 감지 테스트
```python
def test_encoding_utf8():
    """UTF-8 파일 - 첫 번째 시도에서 성공"""
    assert detect_encoding("utf8_file.srt") == "UTF-8"

def test_encoding_cp949():
    """CP949 파일 - 두 번째 시도에서 성공"""
    assert detect_encoding("cp949_file.srt") == "CP949"

def test_encoding_unknown():
    """알 수 없는 인코딩 - 오류"""
    with pytest.raises(EncodingError) as exc:
        detect_encoding("unknown_encoding.srt")
    assert exc.value.code == 202
```

---

## 8. 배포 요구사항

### 8.1 패키징
- **형식**: 단일 실행 파일 (.exe)
- **예상 크기**: 60-70MB (CustomTkinter 포함)
- **의존성**: 모두 포함 (standalone)

### 8.2 설치 및 실행
- 설치 과정 없음 (포터블)
- 관리자 권한 불필요
- Windows Defender 호환성 확보

---

## 9. 제약사항 및 제한

### 9.0 최소 시스템 요구사항
- **OS**: Windows 10 (64-bit) 이상
- **CPU**: Intel i3 또는 AMD Ryzen 3 이상
- **RAM**: 4GB 이상 (8GB 권장)
- **저장 공간**: 100MB (실행 파일 및 설정)
- **디스플레이**: 1366×768 이상
- **.NET Framework**: Windows 기본 포함 버전

### 9.1 지원 제한
- Windows 10, 11만 지원 (64-bit)
- 오프라인 전용
- GUI만 제공
- DPI 스케일링 미지원 (고해상도 디스플레이 사용 예정 없음)

### 9.2 기능 제한
- 드래그 앤 드롭 미지원
- 키보드 단축키 미지원
- 자동 업데이트 미지원
- 진행 표시 없음

---

## 10. 보안 요구사항

### 10.1 데이터 처리
- 모든 처리는 로컬에서만 수행
- 외부 서버 통신 없음
- 임시 파일 자동 정리

---

## 11. 품질 보증

### 11.1 코드 품질
- PEP 8 스타일 가이드 준수
- 타입 힌트 사용
- 문서화 주석 필수
- 단위 테스트 커버리지 100% (코어 로직)

---

## 12. 코드 스타일 가이드

### 12.1 명명 규칙
- 클래스명: PascalCase
- 함수/메서드명: snake_case
- 변수명: snake_case
- 상수: UPPER_SNAKE_CASE

### 12.2 임포트 순서
1. 표준 라이브러리
2. 서드파티 라이브러리 (customtkinter, openpyxl 등)
3. 로컬 모듈

---

## 13. 의존성 관리

### 13.1 필수 의존성 (requirements.txt)
```txt
# GUI
customtkinter==5.2.2

# Excel
openpyxl==3.1.5

# 유틸리티
psutil==5.9.8
chardet==5.2.0

# 패키징
PyInstaller==6.3.0
```

### 13.2 개발 의존성 (requirements-dev.txt)
```txt
pytest==7.4.3
black==23.12.0
mypy==1.7.1
coverage==7.3.2
```

---

## 14. 구현 순서

### Phase 1: 기반 구축
1. CustomTkinter 기본 윈도우 생성
2. CTkSwitch 토글 구현
3. 파일 선택 다이얼로그
4. settings.ini 관리

### Phase 2: 핵심 기능
1. SRT 파서 구현
2. Excel 생성기 구현
3. 언어 코드 감지
4. 타임스탬프 검증

### Phase 3: 변환 로직
1. SRT → XLSX 변환
2. XLSX → SRT 변환
3. 오류 처리
4. 파일 락 구현

### Phase 4: 마무리
1. UI 스타일링
2. 테스트 작성
3. PyInstaller 패키징
4. 최종 검증

---

## 15. LLM 개발 시 금지 사항

### DO NOT USE - 절대 사용 금지
이 도구를 개발할 때 다음 기능들을 **절대 구현하지 마십시오**:

#### 라이브러리 및 모듈 금지
- **DO NOT USE**: `threading`, `multiprocessing`, `concurrent.futures`
  - 단일 스레드로만 구현
- **DO NOT USE**: 외부 SRT 파싱 라이브러리 (`srt`, `pysrt` 등)
  - 수동으로 SRT 파싱 구현 필요
- **DO NOT USE**: `ttkbootstrap`
  - CustomTkinter만 사용

#### UI 기능 금지
- **DO NOT USE**: 프로그레스 바 (`ttk.Progressbar`, `CTkProgressBar`)
  - 진행 표시 없음
- **DO NOT USE**: 드래그 앤 드롭 이벤트 바인딩
  - 파일 다이얼로그만 사용
- **DO NOT USE**: 상태 텍스트 레이블 ("처리 중..." 등)
  - 버튼 비활성화와 커서 변경만 허용

#### 코딩 관행 금지
- **DO NOT AUTO-CORRECT**: 자막 번호나 타임스탬프 자동 수정
  - 오류 발견 시 즉시 중단
- **DO NOT USE**: `logging` 모듈이나 과도한 `print` 문
  - 최소한의 디버깅 출력만 허용
  - 개발용 디버깅 로그는 실행 파일과 같은 위치에 저장
  - Production 버전에서는 모든 디버깅 출력 제거
- **DO NOT IMPLEMENT**: 추가 기능이나 개선사항
  - PRD에 명시된 기능만 구현

#### 파일 처리 금지
- **DO NOT**: PID 기반 파일 락 구현
  - Stale lock 체크 로직만 사용 (섹션 4.4 참조)

### MUST FOLLOW - 반드시 준수
- **MUST**: 오류 코드 체계 사용 (100/200/300번대)
- **MUST**: 타임스탬프 밀리초까지 완전 일치 검증
- **MUST**: 자막 번호 1부터 순차 증가 검증
- **MUST**: 언어 코드 대문자 정규화
- **MUST**: 메모리 사전 체크 구현

---

*이 문서는 PRD 개선 의사결정 질문지의 답변과 아키텍처 검토를 바탕으로 작성되었으며, 모든 모호성을 제거하고 LLM이 명확하고 일관되게 구현할 수 있도록 최적화되었습니다.*